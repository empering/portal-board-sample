<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.re.kari.portal.board.article.ArticleMapper">

    <sql id="where">
        <where>
            <if test="search.boardId != ''">AND BOARD_ID = #{search.boardId}</if>
        </where>
    </sql>

    <select id="findAll" resultType="article">
        SELECT
            ARTICLE_ID,
            PARENT_ARTICLE_ID,
            BOARD_ID,
            NOTICE_YN,
            TITLE,
            CONTENTS,
            READ_COUNT,
            USE_YN,
            REGISTER_ID,
            REGISTER_TIMESTAMP,
            UPDATE_ID,
            UPDATE_TIMESTAMP
        FROM BOARD_ARTICLE
        <include refid="where"></include>
        LIMIT #{pageable.size} OFFSET #{pageable.size} * #{pageable.page}
    </select>

    <select id="count" resultType="int">
        SELECT COUNT(1) AS COUNT
        FROM BOARD_ARTICLE
        <include refid="where"></include>
    </select>

    <select id="findById" resultType="article" parameterType="long">
        SELECT
            ARTICLE_ID,
            PARENT_ARTICLE_ID,
            BOARD_ID,
            NOTICE_YN,
            TITLE,
            CONTENTS,
            READ_COUNT,
            USE_YN,
            REGISTER_ID,
            REGISTER_TIMESTAMP,
            UPDATE_ID,
            UPDATE_TIMESTAMP
        FROM BOARD_ARTICLE
        WHERE ARTICLE_ID = #{articleId}
    </select>

    <insert id="save" parameterType="article" keyProperty="articleId" useGeneratedKeys="true">
        INSERT INTO BOARD_ARTICLE (
        PARENT_ARTICLE_ID,
        BOARD_ID,
        NOTICE_YN,
        TITLE,
        CONTENTS,
        READ_COUNT,
        USE_YN,
        REGISTER_ID
        )
        VALUES (
        #{parentArticleId},
        #{boardId},
        #{noticeYn},
        #{title},
        #{contents},
        0,
        'Y',
        'ADMIN'
        )
    </insert>

    <update id="update" parameterType="article">
        UPDATE BOARD_ARTICLE
        <set>
            <if test="noticeYn != null">NOTICE_YN = #{noticeYn},</if>
            <if test="title != null">TITLE = #{title},</if>
            <if test="contents != null">CONTENTS = #{contents},</if>
            UPDATE_ID = 'ADMIN',
            UPDATE_TIMESTAMP = NOW()
        </set>
        WHERE ARTICLE_ID = #{articleId}
    </update>

    <update id="delete" parameterType="long">
        UPDATE BOARD_ARTICLE
        SET USE_YN = 'N',
            UPDATE_ID = 'ADMIN',
            UPDATE_TIMESTAMP = NOW()
        WHERE ARTICLE_ID = #{articleId}
    </update>

</mapper>
